<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <!-- WiX 5.0 Configuration for LFS Builder MSI Installer -->
  
  <Package 
    Name="LFS Builder" 
    Version="1.0.0.0" 
    Manufacturer="LFS Automated Build"
    UpgradeCode="12345678-1234-1234-1234-123456789012"
    Compressed="yes">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of LFS Builder is already installed." />
    
    <!-- Single feature containing all components -->
    <Feature Id="Complete" Level="1">
      <ComponentGroupRef Id="MainExecutable" />
      <ComponentRef Id="ProgramMenuDir" />
    </Feature>

    <!-- Standard directories -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="LFS Builder">
        <Directory Id="BinFolder" Name="bin" />
      </Directory>
    </StandardDirectory>
    
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ProgramMenuDir" Name="LFS Builder" />
    </StandardDirectory>

    <!-- Main executable component -->
    <ComponentGroup Id="MainExecutable" Directory="BinFolder">
      <Component Id="LFSBuilderSetup.exe" Guid="11111111-1111-1111-1111-111111111111">
        <File Source="..\LFSInstaller\publish\LFSBuilderSetup.exe" KeyPath="yes" />
      </Component>
      
      <Component Id="LFSBuilderSetup.dll" Guid="22222222-2222-2222-2222-222222222222">
        <File Source="..\LFSInstaller\publish\LFSBuilderSetup.dll" />
      </Component>
    </ComponentGroup>

    <!-- Start menu shortcut -->
    <Component Id="ProgramMenuDir" Directory="ProgramMenuDir" Guid="44444444-4444-4444-4444-444444444444">
      <Shortcut Id="ApplicationStartMenuShortcut"
                Name="LFS Builder"
                Description="Launch LFS Builder"
                Target="[BinFolder]LFSBuilderSetup.exe"
                WorkingDirectory="BinFolder" />
      
      <Shortcut Id="UninstallProduct"
                Name="Uninstall LFS Builder"
                Target="[System64Folder]msiexec.exe"
                Arguments="/x [ProductCode]"
                Description="Uninstalls LFS Builder" />
      
      <RemoveFolder Id="RemoveProgramMenuDir" On="uninstall"/>
      <RegistryValue Root="HKCU" Key="Software\LFSBuilder" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
    </Component>

  </Package>
</Wix>
